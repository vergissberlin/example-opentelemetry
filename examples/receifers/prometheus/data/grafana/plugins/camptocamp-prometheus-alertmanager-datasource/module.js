define(["@grafana/data","@grafana/runtime","rxjs","react","@grafana/ui"],((e,t,r,n,i)=>(()=>{"use strict";var a={305:t=>{t.exports=e},545:e=>{e.exports=t},388:e=>{e.exports=i},650:e=>{e.exports=n},177:e=>{e.exports=r}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return a[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{l.r(s),l.d(s,{plugin:()=>m});var e=l(305),t=l(545),r=l(177);const n={active:!0,silenced:!1,inhibited:!1};function i(e,t,r,n,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){i(o,n,a,l,s,"next",e)}function s(e){i(o,n,a,l,s,"throw",e)}l(void 0)}))}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c extends e.DataSourceApi{query(i){var l=this;return a((function*(){const a=i.targets.map((a=>{if(a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){o(e,t,r[t])}))}return e}({},n,a),a.hide)return Promise.resolve(new e.MutableDataFrame);let s=[];return s.push("active="+(a.active?"true":"false")),s.push("silenced="+(a.silenced?"true":"false")),s.push("inhibited="+(a.inhibited?"true":"false")),void 0!==a.receiver&&a.receiver.length>0&&s.push(`receiver=${a.receiver}`),void 0!==a.filters&&a.filters.length>0&&(a.filters=(0,t.getTemplateSrv)().replace(a.filters,i.scopedVars,l.interpolateQueryExpr),a.filters.split(",").forEach((e=>{s.push(`filter=${encodeURIComponent(e)}`)}))),l.doRequest({url:`${l.url}/api/v2/alerts?${s.join("&")}`,method:"GET"}).then((e=>(0,r.lastValueFrom)(e))).then((e=>l.retrieveData(a,e)))}));return Promise.all(a).then((e=>({data:e})))}))()}doRequest(e){var r=this;return a((function*(){return e.withCredentials=r.withCredentials,e.headers=r.headers,(0,t.getBackendSrv)().fetch(e)}))()}testDatasource(){var e=this;return a((function*(){return e.doRequest({url:e.url,method:"GET"}).then((e=>(0,r.lastValueFrom)(e).then((e=>void 0!==e?e.ok?{status:"success",message:"Datasource is working",title:"Success"}:{status:"error",message:`Datasource is not working: ${e.data}`,title:"Error"}:{status:"error",message:"Unknown error in datasource",title:"Error"}))))}))()}buildDataFrame(t,r){const n=[{name:"Time",type:e.FieldType.time},{name:"SeverityValue",type:e.FieldType.number}];if(r.length>0){const t=r.map((e=>Object.keys(e.annotations))).flat(),i=r.map((e=>Object.keys(e.labels))).flat();[...new Set([...t,...i,"alertstatus","alertstatus_code"])].forEach((t=>{n.push({name:t,type:e.FieldType.string})}))}return new e.MutableDataFrame({refId:t,fields:n})}parseAlertAttributes(e,t){let r=4;switch(e.labels.severity){case"critical":r=1;break;case"warning":r=2;break;case"info":r=3}const n=[e.startsAt,r];return t.slice(2).forEach((t=>{n.push(e.annotations[t.name]||e.labels[t.name]||"")})),n}retrieveData(e,t){const r=this.buildDataFrame(e.refId,t.data);return t.data.forEach((e=>{const t=this.parseAlertAttributes(e,r.fields);r.appendRow(t)})),Promise.resolve(r)}interpolateQueryExpr(e=[],t){if(!t.multi&&!t.includeAll)return function(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}(e);if("string"==typeof e)return u(e);const r=e.map((e=>u(e)));return 1===r.length?r[0]:"("+r.join("|")+")"}constructor(e){super(e),o(this,"url",void 0),o(this,"withCredentials",void 0),o(this,"headers",void 0),this.url=void 0===e.url?"":e.url,this.withCredentials=void 0!==e.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof e.basicAuth&&e.basicAuth.length>0&&(this.headers.Authorization=e.basicAuth)}}function u(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?()|]/g,"\\\\$&"):e}var p=l(650),d=l.n(p),f=l(388);function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){h(e,t,r[t])}))}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const m=new e.DataSourcePlugin(c).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e;return d().createElement("div",{className:"gf-form-group"},d().createElement(f.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:r,showAccessOptions:!0,onChange:t}))})).setQueryEditor((function({query:e,onChange:t,onRunQuery:r}){const{receiver:i,filters:a,active:o,silenced:l,inhibited:s}=v({},n,e);return d().createElement("div",null,d().createElement(f.InlineFieldRow,null,d().createElement(f.InlineField,{label:"Receiver"},d().createElement(f.Input,{name:"Receiver input",onChange:n=>{t(b(v({},e),{receiver:n.target.value})),r()},value:i,width:10})),d().createElement(f.InlineField,{label:"Filters (comma separated key=value)"},d().createElement(f.Input,{name:"Filters input",onChange:n=>{t(b(v({},e),{filters:n.target.value})),r()},value:a,width:30}))),d().createElement(f.InlineFieldRow,null,d().createElement(f.InlineField,{label:"Active"},d().createElement(f.InlineSwitch,{value:o,onChange:()=>{e.active=!e.active,t(v({},e)),r()}})),d().createElement(f.InlineField,{label:"Silenced"},d().createElement(f.InlineSwitch,{value:l,onChange:()=>{e.silenced=!e.silenced,t(v({},e)),r()}})),d().createElement(f.InlineField,{label:"Inhibited"},d().createElement(f.InlineSwitch,{value:s,onChange:()=>{e.inhibited=!e.inhibited,t(v({},e)),r()}}))))}))})(),s})()));
//# sourceMappingURL=module.js.map